---
title: é—­åŒ…ä¸Žé«˜é˜¶å‡½æ•°
categories: JavaScript
---

ä»‹ç» js ä½œç”¨åŸŸä¸Žä½œç”¨åŸŸé“¾ï¼Œé«˜é˜¶å‡½æ•°ï¼Œé—­åŒ…çš„æ¦‚å¿µ

**é—­åŒ…å°†å‡½æ•°å’Œå‡½æ•°çš„è¯æ³•ä½œç”¨åŸŸç»‘å®šåœ¨ä¸€èµ·**ã€‚ä½¿å¾—å†…å±‚å‡½æ•°èƒ½å¤Ÿè®¿é—®åˆ°å¤–å±‚å‡½æ•°çš„ä½œç”¨åŸŸ

### JS ä¸‰ç§ä½œç”¨åŸŸ

- å…¨å±€ä½œç”¨åŸŸ global scope
- å‡½æ•°ä½œç”¨åŸŸ function scope
- å—ä½œç”¨åŸŸ block scope

### è¯æ³•ä½œç”¨åŸŸ ï¼ˆé™æ€ä½œç”¨åŸŸï¼‰

> è¯æ³•ä½œç”¨åŸŸï¼Œå°±æ„å‘³ç€å‡½æ•°è¢«å®šä¹‰çš„æ—¶å€™ï¼Œå®ƒçš„ä½œç”¨åŸŸå°±å·²ç»ç¡®å®šäº†ï¼Œå’Œæ‹¿åˆ°å“ªé‡Œæ‰§è¡Œæ²¡æœ‰å…³ç³»ï¼Œå› æ­¤è¯æ³•ä½œç”¨åŸŸä¹Ÿè¢«ç§°ä¸º â€œé™æ€ä½œç”¨åŸŸâ€ã€‚

```jsx
var value = 1;

function foo() {
  console.log(value);
}

function bar() {
  var value = 2;
  foo();
}

bar();

// ç»“æžœæ˜¯ ???
```

### ä½œç”¨åŸŸé“¾

å‡½æ•°è°ƒç”¨æ—¶ä¼šåˆ›å»ºä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡åŠ å…¥åˆ°è°ƒç”¨æ ˆä¸­ï¼Œæ¯ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡éƒ½åŒ…å«ä¸€ä¸ªå˜é‡å¯¹è±¡ï¼ŒåŒ…å«äº†å½“å‰ä¸Šä¸‹æ–‡çŽ¯å¢ƒä¸‹å®šä¹‰çš„æ‰€æœ‰å˜é‡å’Œå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯å‡½æ•°è‡ªå·±çš„ä½œç”¨åŸŸã€‚

å‡½æ•°çš„ä½œç”¨åŸŸä¼šæ ¹æ®å‡½æ•°å®šä¹‰çš„ä½ç½®è¢«é“¾æŽ¥åˆ°è°ƒç”¨æ ˆä¸­å…¶ä»–æ‰§è¡Œä¸Šä¸‹æ–‡çš„ä½œç”¨åŸŸï¼Œç›´åˆ°å…¨å±€ä½œç”¨åŸŸ

å˜é‡çš„è®¿é—®é¡ºåºä¹Ÿä¼šæ ¹æ®ä½œç”¨åŸŸé“¾æ¥æŸ¥æ‰¾

### é«˜é˜¶å‡½æ•°

> é«˜é˜¶å‡½æ•°å³**å°†å…¶ä»–å‡½æ•°ä½œä¸ºå‚æ•°æˆ–è€…è¿”å›žå€¼**çš„ä¸€ç±»å‡½æ•°

å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ï¼Œæ˜¯ JS ä¸­çš„ä¸€ç­‰å…¬æ°‘ï¼Œèƒ½å¤Ÿ

- ç»™å˜é‡èµ‹å€¼
- ä¼ é€’ç»™å‡½æ•°ä½œä¸ºå‚æ•°
- ä½œä¸ºè¿”å›žå€¼

```jsx
function a(fn) {}
function b() {
  return function () {};
}
```

### ä»€ä¹ˆæ˜¯é—­åŒ…

> **é‚£äº›å¼•ç”¨äº†å¦ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸä¸­å˜é‡çš„å‡½æ•°**ï¼Œé€šå¸¸æ˜¯åœ¨åµŒå¥—å‡½æ•°ä¸­å®žçŽ°çš„

æ¯”å¦‚è¯´åœ¨å‡½æ•°ä¸­å®šä¹‰å‡½æ•°ï¼ˆåµŒå¥—å‡½æ•°ï¼‰ï¼Œç„¶åŽå°†å‡½æ•°ä½œä¸ºå€¼ä¼ é€’å‡ºåŽ»ï¼Œè€Œä¼ é€’å‡ºåŽ»çš„å‡½æ•°åˆå¼•ç”¨çš„å½“å‰å‡½æ•°ä¸‹çš„å˜é‡ï¼Œé‚£ä¹ˆåœ¨å½“å‰å‡½æ•°æ‰§è¡Œå®Œä¹‹åŽï¼Œå˜é‡çš„å¼•ç”¨ä¾ç„¶å­˜åœ¨ä¸ä¼šè¢«é”€æ¯ã€‚

ç”±äºŽæ¯ä¸ªå‡½æ•°æ‹¥æœ‰è‡ªå·±çš„ä½œç”¨åŸŸï¼Œæ ¹æ®å‡½æ•°å®šä¹‰çš„ä½ç½®ï¼Œa å’Œ b ä¹‹é—´çš„å˜é‡æ˜¯ä¸èƒ½ç›¸äº’è®¿é—®çš„

```jsx
function a() {}
function b() {}
```

é‚£ä¹ˆä»€ä¹ˆæƒ…å†µä¸‹ä¸€ä¸ªå‡½æ•°èƒ½å¤Ÿè®¿é—®å¦ä¸€ä¸ªå‡½æ•°çš„å˜é‡ï¼Ÿ åµŒå¥—å®šä¹‰

é—­åŒ… = å‡½æ•° + å‡½æ•°çš„è¯æ³•çŽ¯å¢ƒ ï¼ˆ**lexical environment**ï¼‰

è¯æ³•çŽ¯å¢ƒåŒ…å«äº†å£°æ˜Žè¯¥å‡½æ•°æ—¶çš„ä½œç”¨åŸŸ

åœ¨ JavaScript ä¸­ï¼Œæ¯å½“åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œé—­åŒ…å°±ä¼šåœ¨å‡½æ•°åˆ›å»ºçš„åŒæ—¶è¢«åˆ›å»ºå‡ºæ¥ã€‚

æ‰€ä»¥ï¼Œé—­åŒ…è®©ä½ å¯ä»¥åœ¨ä¸€ä¸ªå†…å±‚å‡½æ•°ä¸­è®¿é—®åˆ°å…¶å¤–å±‚å‡½æ•°çš„ä½œç”¨åŸŸï¼Œæž„æˆ**ä½œç”¨åŸŸé“¾**ã€‚

åœ¨**é«˜é˜¶å‡½æ•°**ä¸­ï¼Œå‡½æ•°å¯ä»¥ä½œä¸ºè¿”å›žå€¼ï¼Œå³ä½¿é«˜é˜¶å‡½æ•°å·²ç»æ‰§è¡Œå®Œæ¯•ä»Žè°ƒç”¨æ ˆä¸­å¼¹å‡ºï¼Œæ‰€è¿”å›žçš„å‡½æ•°ä¾ç„¶å¯ä»¥åœ¨å…¶ä»–åœ°æ–¹é‡å¤è°ƒç”¨ã€‚

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æžœè¿”å›žçš„å‡½æ•°ä¸­å¼•ç”¨äº†é«˜é˜¶å‡½æ•°ä¸­çš„æŸäº›å˜é‡ï¼Œè¿™äº›å˜é‡çš„å€¼ä¼šè¢«ä¿ç•™ï¼Œä¸ä¼šè¢«é”€æ¯ã€‚**å› ä¸ºé—­åŒ…å°†å‡½æ•°å’Œå‡½æ•°çš„è¯æ³•ä½œç”¨åŸŸç»‘å®šåœ¨ä¸€èµ·**ã€‚

### é—­åŒ…çš„å¥½å¤„

1. memory efficientã€‚ å†ä¸æ±¡æŸ“å…¨å±€å˜é‡çŽ¯å¢ƒçš„æƒ…å†µä¸‹ï¼Œé¿å…å˜é‡çš„é‡å¤åˆ›å»º

   - ä¾‹å­

     ```jsx
     function heavyDuty2() {
       const bigArray = new Array(700).fill("ðŸ•");
       console.log("created again ");
       return function (index) {
         return bigArray[index];
       };
     }

     //bigArray åªè¢«åˆ›å»ºçš„ä¸€æ¬¡ï¼Œä¸”æ²¡æœ‰æ±¡æŸ“å…¨å±€ä½œç”¨åŸŸ
     const read = heavyDuty2();
     read(212);
     read(212);
     read(212);
     ```

2. encapsulation å®žçŽ°å°è£…ï¼Œå¯ä»¥æ¨¡æ‹Ÿç§æœ‰å±žæ€§æˆ–æ–¹æ³•

   - ä¾‹å­

     ```jsx
     const moneyPrinter = () => {
       //åªæä¾›ä¸€äº›apiæ“ä½œmoneyï¼Œä½†ä¸æƒ³å¯¹å¤–æš´éœ²money
       let money = 0;
       const printMoney = () => money++;
       const getCurrentMoney = () => money;
       return {
         printMoney: printMoney,
         getCurrentMoney: getCurrentMoney,
       };
     };

     let moneyMaker = moneyPrinter();
     console.log(moneyMaker.printMoney());
     console.log(moneyMaker.printMoney());
     console.log(moneyMaker.getCurrentMoney());
     ```

## å‚è€ƒ

ã€ŠJavaScript è®¾è®¡æ¨¡å¼ä¸Žå¼€å‘å®žè·µã€‹

[ã€Udemy ä»˜è´¹è¯¾ç¨‹ã€‘JavaScript: The Advanced Concepts --> JS é«˜çº§è¿›é˜¶è¯¾ç¨‹ï¼ˆä¸­æ–‡å­—å¹•ï¼‰\_å“”å“©å“”å“©\_bilibili](https://www.bilibili.com/video/BV19i4y1Q7w7?p=52)

https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Closures
